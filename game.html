<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="game.css" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
    <title>Document</title>
</head>
<body>
    <div class="logo"><center><img src="Asset untuk html/Main Menu/logo.png"></center></div>
    <hr style="background-color: white; height: 2px; opacity: 1;"/>
    <center>
        <div class="bars">
        <div class="container-fluid">
            <div class="row">
              <div class="col-md-6 col-lg-6 order-md-2">
                  <div class="bar-container">
                    <label for="food">Food</label>
                    <meter value="50" min="0" max="100" low="25" id="food"></meter>
                </div>
            </div>
            <div class="col-md-6 col-lg-6">
                  <div class="bar-container">
                    <label for="health">Health</label>
                    <meter value="50" min="0" max="100" low="25" id="health"></meter>
                </div>
              </div>
            </div>
            <div class="row">
              <div class="col-md-6 col-lg-6">
                <div class="bar-container">
                  <label for="sleep">Sleep</label>
                  <meter value="50" min="0" max="100" low="25" id="sleep"></meter>
                </div>
              </div>
              <div class="col-md-6 col-lg-6">
                <div class="bar-container">
                  <label for="exp">EXP</label>
                  <meter value="0" min="0" max="100" low="25" id="exp"></meter>
                </div>
              </div>
            </div>
            <p class="level" id="level"></p>
          </div>
        </div>
        </center>
        <div class="body">
            <div class="greetings">
                <span id="greeting">Playing</span> <span id="petname"></span>
                <br>
                <br>
                <span id="time">06:00</span>
                <!-- Display the time starting from 06:00 -->
            </div>
    <div class="player" id="my-image"><img id="petImage" src=""></div>
    <div class="object"><img src="Asset untuk html/bintang.png" /></div>
    <!-- <div class="container">
        <div class="row row-cols-2 fixed-bottom mb-3 mx-2">
            <div class="col my-1"><button class="myButton">Makan</button></div>
            <div class="col my-1"><button class="myButton">Tidur</button></div>
            <div class="col my-1"><button class="myButton">Main</button></div>
            <div class="col my-1"><button class="myButton">Obat</button></div>
        </div>
    </div> -->
    <center>
    <div class="container uiBox">
        <div class="row">
        <div class="col-sm-6 col-md-6 col-lg-6">
        <div class="btnkiri btn-group-vertical btn-block">
            <button id="btnMakan" class="btn btn-light" onclick="changeImageMakan()"><span>MAKAN</span></button>
            <br>
            <button id="btnMain" class="btn btn-light" onclick="saveValueAndRedirect()"><span>BACK</span></button>
        </div>
        </div>
        <div class="col-sm-6 col-md-6 col-lg-6">
        <div class="btnkanan btn-group-vertical btn-block">
            <button id="btnTidur" class="btn btn-light" onclick="changeImageTidur()"><span>TIDUR</span></button>
            <br>
            <button id="btnObat" class="btn btn-light" onclick="changeImageMakan()"><span>OBAT</span></button>
        </div>
        </div>
        </div>
        </div>
    </center>
    <div class="fixed-bottom">
        <button class="buttonUp">^</button>
        <button class="buttonDown">\/</button>
        <button class="buttonLeft">&lt;</button>
        <button class="buttonRight">&gt;</button>
    </div>
    <script>
        const charImg = localStorage.getItem("charImg");
        document.getElementById("petImage").src = charImg;

        function saveValueAndRedirect()
        {
            var health = document.getElementById("health").value;
            var food = document.getElementById("food").value;
            var sleep = document.getElementById("sleep").value;
            var exp = document.getElementById("exp").value;
            var petImage = document.getElementById("petImage").src;
            // var time = document.getElementById("time").value;
            localStorage.setItem("health", health);
            localStorage.setItem("food", food);
            localStorage.setItem("sleep", sleep);
            localStorage.setItem("exp", exp);
            localStorage.setItem("petImage", petImage);
            // localStorage.setItem("time", time);
            window.location.href = "home.html";
        }

        function changeImageMakan()
        {
            var img = document.getElementById("petImage");
            var oldSrc = img.src;
            if(oldSrc.includes("chara1.png") || oldSrc.includes("Untitled34_20230402121238.png") || oldSrc.includes("Untitled34_20230402121748.png"))
            {
                var newSrc = "Asset untuk html/character/chara1/chara1makan2.png";
                img.src = newSrc;
                setTimeout(function() 
                {
                    img.src = oldSrc;
                }, 15000); // 15 seconds in milliseconds
            }

            if(oldSrc.includes("chara2.png") || oldSrc.includes("Untitled34_20230402122203.png") || oldSrc.includes("Untitled34_20230402122252.png"))
            {
                var newSrc = "Asset untuk html/character/chara2/chara2makan2.png";
                img.src = newSrc;
                setTimeout(function() 
                {
                    img.src = oldSrc;
                }, 15000); // 15 seconds in milliseconds
            }

            if(oldSrc.includes("chara3.png") || oldSrc.includes("Untitled34_20230402123124.png") || oldSrc.includes("Untitled34_20230402123255.png"))
            {
                var newSrc = "Asset untuk html/character/chara3/chara3makan2.png";
                img.src = newSrc;
                setTimeout(function() 
                {
                    img.src = oldSrc;
                }, 15000); // 15 seconds in milliseconds
            }
        }
        
        function changeImageTidur()
        {
            {
            var img = document.getElementById("petImage");
            var oldSrc = img.src;
            if(oldSrc.includes("chara1.png") || oldSrc.includes("Untitled34_20230402121238.png") || oldSrc.includes("Untitled34_20230402121748.png"))
            {
                var newSrc = "Asset untuk html/character/chara1/chara1tidur.gif";
                img.src = newSrc;
                setTimeout(function() 
                {
                    img.src = oldSrc;
                }, 15000); // 15 seconds in milliseconds
            }

            if(oldSrc.includes("chara2.png") || oldSrc.includes("Untitled34_20230402122203.png") || oldSrc.includes("Untitled34_20230402122252.png"))
            {
                var newSrc = "Asset untuk html/character/chara2/chara2makan2.png";
                img.src = newSrc;
                setTimeout(function() 
                {
                    img.src = oldSrc;
                }, 15000); // 15 seconds in milliseconds
            }

            if(oldSrc.includes("chara3.png") || oldSrc.includes("Untitled34_20230402123124.png") || oldSrc.includes("Untitled34_20230402123255.png"))
            {
                var newSrc = "Asset untuk html/character/chara3/chara3tidur.gif";
                img.src = newSrc;
                setTimeout(function() 
                {
                    img.src = oldSrc;
                }, 15000); // 15 seconds in milliseconds
            }
            }
        }

        let player = document.querySelector('.player');
        let object = document.querySelector('.object');
        let moveBy = 50;
        let score = 0;
        let scoreElement = document.createElement('div');
        scoreElement.innerHTML = `Score: ${score}`;
        document.body.appendChild(scoreElement);
        var image = document.getElementById("my-image");
        var exp = localStorage.getItem("exp");
        document.getElementById("exp").value = exp;
        
        window.addEventListener('load', () =>{
            const middleX = window.innerWidth / 2 - player.clientWidth / 2;
            const middleY = window.innerHeight / 2 - player.clientHeight / 2;
            player.style.position = 'absolute';
            player.style.left = 600 + 'px';
            player.style.top = middleY + 'px';
            object.style.position = 'absolute';
            const maxX = middleX + 50;
            const maxY = middleY + 50;
            const minX = middleX - 50;
            const minY = middleY - 50;
            object.style.left = Math.floor(Math.random() * (maxX - minX) + minX) + 'px';
            object.style.top = Math.floor(Math.random() * (maxY - minY) + minY) + 'px';
        });

        window.addEventListener('keyup', (e) =>{
            var healthMeter = document.getElementById("health");
            var foodMeter = document.getElementById("food");
            var sleepMeter = document.getElementById("sleep");
            switch(e.key)
            {
                case 'ArrowLeft':
                    player.style.left = parseInt(player.style.left) - moveBy + 'px';
                    image.style.transform = 'none';
                    break;
                    
                case 'ArrowRight':
                    //image.style.transform = 'scaleX(-1)';
                    player.style.left = parseInt(player.style.left) + moveBy + 'px';
                break;

                case 'ArrowUp':
                    player.style.top = parseInt(player.style.top) - moveBy + 'px';
                    break;

                case 'ArrowDown':
                    player.style.top = parseInt(player.style.top) + moveBy + 'px';
                    break;
            }
            if (isColliding(player, object)) {
                score++;
                healthMeter.value -= 3;
                foodMeter.value -= 3;
                sleepMeter.value -= 3;
                exp = parseInt(exp) + 3;
                document.getElementById("exp").value = exp;
                scoreElement.innerHTML = `Score: ${score}`;
                object.style.display = 'none';
                object.style.left = Math.floor(Math.random() * 500) + 'px';
                object.style.top = Math.floor(Math.random() * 500) + 'px';
                setTimeout(() => object.style.display = 'block', 2000);
            }
        });
        
        const buttonUp = document.querySelector('.buttonUp');
        const buttonDown = document.querySelector('.buttonDown');
        const buttonLeft = document.querySelector('.buttonLeft');
        const buttonRight = document.querySelector('.buttonRight');
        var healthMeter = document.getElementById("health");
        var foodMeter = document.getElementById("food");
        var sleepMeter = document.getElementById("sleep");

        buttonUp.addEventListener('click', () => {
            player.style.top = parseInt(player.style.top) - moveBy + 'px';
            if (isColliding(player, object)) {
                score++;
                healthMeter.value -= 3;
                foodMeter.value -= 3;
                sleepMeter.value -= 3;
                exp = parseInt(exp) + 3;
                document.getElementById("exp").value = exp;
                scoreElement.innerHTML = `Score: ${score}`;
                object.style.display = 'none';
                object.style.left = Math.floor(Math.random() * 500) + 'px';
                object.style.top = Math.floor(Math.random() * 500) + 'px';
                setTimeout(() => object.style.display = 'block', 2000);
            }
        });

        buttonDown.addEventListener('click', () => {
            player.style.top = parseInt(player.style.top) + moveBy + 'px';
            if (isColliding(player, object)) {
                score++;
                healthMeter.value -= 3;
                foodMeter.value -= 3;
                sleepMeter.value -= 3;
                exp = parseInt(exp) + 3;
                document.getElementById("exp").value = exp;
                scoreElement.innerHTML = `Score: ${score}`;
                object.style.display = 'none';
                object.style.left = Math.floor(Math.random() * 500) + 'px';
                object.style.top = Math.floor(Math.random() * 500) + 'px';
                setTimeout(() => object.style.display = 'block', 2000);
            }
        });

        buttonLeft.addEventListener('click', () => {
            player.style.left = parseInt(player.style.left) - moveBy + 'px';
            image.style.transform = 'none';
            if (isColliding(player, object)) {
                score++;
                healthMeter.value -= 3;
                foodMeter.value -= 3;
                sleepMeter.value -= 3;
                exp = parseInt(exp) + 3;
                document.getElementById("exp").value = exp;
                scoreElement.innerHTML = `Score: ${score}`;
                object.style.display = 'none';
                object.style.left = Math.floor(Math.random() * 500) + 'px';
                object.style.top = Math.floor(Math.random() * 500) + 'px';
                setTimeout(() => object.style.display = 'block', 2000);
            }
        });
        
        buttonRight.addEventListener('click', () => {
            player.style.left = parseInt(player.style.left) + moveBy + 'px';
            //image.style.transform = 'scaleX(-1)';
            if (isColliding(player, object)) {
                score++;
                healthMeter.value -= 3;
                foodMeter.value -= 3;
                sleepMeter.value -= 3;
                exp = parseInt(exp) + 3;
                document.getElementById("exp").value = exp;
                scoreElement.innerHTML = `Score: ${score}`;
                object.style.display = 'none';
                object.style.left = Math.floor(Math.random() * 500) + 'px';
                object.style.top = Math.floor(Math.random() * 500) + 'px';
                setTimeout(() => object.style.display = 'block', 2000);
            }
        });

        function isColliding(el1, el2) {
            let rect1 = el1.getBoundingClientRect();
            let rect2 = el2.getBoundingClientRect();
            return !(
            rect1.bottom < rect2.top ||
            rect1.top > rect2.bottom ||
            rect1.right < rect2.left ||
            rect1.left > rect2.right
            );
        }

        // Get pet name from localStorage and display it
        // Get pet name from localStorage and display it
        var petname = localStorage.getItem("petname");
        document.getElementById("petname").textContent = petname;

        // Update time every second
        var timeElement = document.querySelector(".greetings > #time");
        var greetingElement = document.querySelector(".greetings > #greeting");
        var hours = 6;
        var minutes = 0;
        var intervalId;

        function updateClock() {
            minutes += 1;
            if (minutes >= 60) {
                hours++;
                minutes -= 60;
            }
            var timeString = hours.toString().padStart(2, "0") + ":" + minutes.toString().padStart(2, "0");
            timeElement.textContent = timeString;

            // Update greeting based on time
            var time = hours * 100 + minutes;
            if (time >= 1900 || time < 400) {
                document.body.style.backgroundImage = "url('Asset untuk html/game_background_1.png')";
            } else if (time >= 400 && time < 1100) {
                document.body.style.backgroundImage = "url('Asset untuk html/game_background_4.png')";
            } else if (time >= 1100 && time < 1500) {
                document.body.style.backgroundImage = "url('Asset untuk html/game_background_4.png')";
            } else {
                document.body.style.backgroundImage = "url('Asset untuk html/game_background_2.png')";
            }
        }

        intervalId = setInterval(updateClock, 1000);




        // Tidur button click event handler
        var btnTidur = document.querySelector(".btnkanan > .btn:first-of-type");
        btnTidur.addEventListener("click", function () {
            var sleepMeter = document.getElementById("sleep");
            sleepMeter.value = 100; // fill up the sleep meter
            hours += 8; // pass 8 hours
            if (hours >= 24) {
                hours -= 24;
            }
            updateClock();
        });

        // Main button click event handler
        // Main button click event handler
        var btnMain = document.getElementById("btnMain");
        btnMain.addEventListener("click", function () {
            hours += 6; // progress the time by 6 hours  
            if (hours >= 24) {
                hours -= 24;
            }
            var timeString = hours.toString().padStart(2, "0") + ":" + minutes.toString().padStart(2, "0");
            timeElement.textContent = timeString;
        });


        // Play button click event handler
        var btnPlay = document.querySelector(".btnkiri > .btn:last-of-type");
        btnPlay.addEventListener("click", function () {
            minutes += 10; // progress the time by 10 minutes
            if (minutes >= 60) {
                hours++;
                minutes -= 60;
            }
            updateClock();
        });

        // Obat button click event handler
        // Makan button click event handler
        var btnMakan = document.querySelector(".btnkiri > .btn:first-of-type");
        btnMakan.addEventListener("click", function () {
            var foodMeter = document.getElementById("food");
            var healthMeter = document.getElementById("health");
            var sleepMeter = document.getElementById("sleep");
            foodMeter.value += 20; // increase food meter by 20
            if (foodMeter.value > 100) {
                foodMeter.value = 100;
            }
            minutes += 30; // progress the time by 30 minutes
            if (minutes >= 60) {
                hours++;
                minutes -= 60;
            }
            updateClock();
            sleepMeter.value -= 5; // decrease sleep meter by 5
        });

        // Obat button click event handler
        var btnObat = document.querySelector(".btnkanan > .btn:last-of-type");
        btnObat.addEventListener("click", function () {
            var foodMeter = document.getElementById("food");
            var healthMeter = document.getElementById("health");
            var sleepMeter = document.getElementById("sleep");
            healthMeter.value += 20; // increase health meter by 20
            if (healthMeter.value > 100) {
                healthMeter.value = 100;
            }
            minutes += 10; // progress the time by 10 minutes
            if (minutes >= 60) {
                hours++;
                minutes -= 60;
            }
            updateClock();
            sleepMeter.value -= 5; // decrease sleep meter by 5
        });


        // Decrement health, food, and sleep meters by 10 every minute
        setInterval(function () {
            var healthMeter = document.getElementById("health");
            var foodMeter = document.getElementById("food");
            var sleepMeter = document.getElementById("sleep");
            healthMeter.value -= 10;
            foodMeter.value -= 10;
            sleepMeter.value -= 10;
            if (healthMeter.value < 0) {
                healthMeter.value = 0;
            }
            if (foodMeter.value < 0) {
                foodMeter.value = 0;
            }
            if (sleepMeter.value < 0) {
                sleepMeter.value = 0;
            }
            // Check if game is over
            if (healthMeter.value == 0 || foodMeter.value == 0 || sleepMeter.value == 0) {
                // Game over
                alert("Game Over!");
                // Stop the decrementing of meters
                clearInterval(intervalId);
            }
        }, 30000); // 1 minute = 60,000 milliseconds


        var btnMain = document.getElementById("btnMain");
        btnMain.addEventListener("click", function () {
            var foodMeter = document.getElementById("food");
            var healthMeter = document.getElementById("health");
            var sleepMeter = document.getElementById("sleep");
            var expMeter = document.getElementById("exp");
            foodMeter.value -= 30; // decrease food meter by 30
            healthMeter.value -= 30; // decrease health meter by 30
            sleepMeter.value -= 30; // decrease sleep meter by 30
            if (foodMeter.value < 0) {
                foodMeter.value = 0;
            }
            if (healthMeter.value < 0) {
                healthMeter.value = 0;
            }
            if (sleepMeter.value < 0) {
                sleepMeter.value = 0;
            }
            expMeter.value += 50; // increase exp meter by 50
            if (expMeter.value > 100) {
                expMeter.value = 100;
            }
            hours += 6; // progress the time by 6 hours
            if (hours >= 24) {
                hours -= 24;
            }
            var timeString = hours.toString().padStart(2, "0") + ":" + minutes.toString().padStart(2, "0");
            timeElement.textContent = timeString;
        });

        // Inisialisasi variabel level awal
        var level = localStorage.getItem("level");
        document.getElementById("level").textContent = level;

        function increaseExp() 
        {
            let level = 1;
            const expMeter = document.getElementById("exp");
            const currentExp = parseInt(expMeter.value);
            const newExp = currentExp + 3;
            var img = document.getElementById("petImage");

            // Check if exp has reached 100
            if (newExp >= 100) 
            {
                // If yes, increase level and reset exp
                if(level >= 3)
                {
                    return;
                } 

                else 
                {
                    level++;
                    expMeter.value = 0;
                    document.getElementById("level").textContent = "Level " + level;
                }
                
                if(level == 2)
                {
                    var oldSrc = img.src;
                    var newSrc = "Asset untuk html/Evolusi chara/Untitled34_20230402121238.png";
                    if(oldSrc.includes("chara1.png"))
                    {
                        img.src = newSrc;
                    }

                    if(oldSrc.includes("chara2.png"))
                    {
                        img.src = "Asset untuk html/Evolusi chara/Untitled34_20230402122203.png";
                        newSrc = "Asset untuk html/Evolusi chara/Untitled34_20230402122203.png";
                    }

                    if(oldSrc.includes("chara3.png"))
                    {
                        img.src = "Asset untuk html/Evolusi chara/Untitled34_20230402123124.png";
                        newSrc = "Asset untuk html/Evolusi chara/Untitled34_20230402123124.png";
                    }
                }

                if(level == 3)
                {
                    var oldSrc = img.src;
                    if(oldSrc.includes("Untitled34_20230402121238.png"))
                    {
                        img.src = "Asset untuk html/Evolusi chara/Untitled34_20230402121748.png";
                    }

                    if(oldSrc.includes("Untitled34_20230402122203.png"))
                    {
                        img.src = "Asset untuk html/Evolusi chara/Untitled34_20230402122252.png";
                    }

                    if(oldSrc.includes("Untitled34_20230402123124.png"))
                    {
                        img.src = "Asset untuk html/Evolusi chara/Untitled34_20230402123255.png";
                    }
                }

                } else 
                {
                    // If not, increase exp
                    expMeter.value = newExp;
                }
            }

            // Call increaseExp function every 20 seconds
            setInterval(increaseExp, 30000);


//         function increaseExp() 
//         {
//             let level = 1;
//             const expMeter = document.getElementById("exp");
//             const currentExp = parseInt(expMeter.value);
//             const newExp = currentExp + 3;
//             var img = document.getElementById("petImage");
//             // Cek apakah exp sudah mencapai 100
//             if (newExp >= 100) 
//             {
//             // Jika ya, tingkatkan level dan reset exp
//                 if(level >= 3)
//                 {
//                     return;
//                 }
//                 else 
//                 {
//                     level++;
//                     expMeter.value = 0;
//                     document.getElementById("level").textContent = "Level " + level;
//                 }

//                 if(level == 2)
//                 {
//                     var oldSrc = img.src;
//                     if(oldSrc.includes("chara1.png") || oldSrc.includes("Untitled34_20230402121238.png") || oldSrc.includes("Untitled34_20230402121748.png"))
//                     {
//                         img.src = "Asset untuk html/Evolusi chara/Untitled34_20230402121238.png";
//                     }

//                     if(oldSrc.includes("chara2.png") || oldSrc.includes("Untitled34_20230402122203.png") || oldSrc.includes("Untitled34_20230402122252.png"))
//                     {
//                         img.src = "Asset untuk html/Evolusi chara/Untitled34_20230402122203.png";
//                     }

//                     if(oldSrc.includes("chara3.png") || oldSrc.includes("Untitled34_20230402123124.png") || oldSrc.includes("Untitled34_20230402123255.png"))
//                     {
//                         img.src = "Asset untuk html/Evolusi chara/Untitled34_20230402123124.png";
//                     }
//                 }

//                 if(level == 3)
//                 {
//                     if(oldSrc.includes("chara1.png") || oldSrc.includes("Untitled34_20230402121238.png") || oldSrc.includes("Untitled34_20230402121748.png"))
//                     {
//                         img.src = "Asset untuk html/Evolusi chara/Untitled34_20230402121748.png";
//                     }

//                     if(oldSrc.includes("chara2.png") || oldSrc.includes("Untitled34_20230402122203.png") || oldSrc.includes("Untitled34_20230402122252.png"))
//                     {
//                         img.src = "Asset untuk html/Evolusi chara/Untitled34_20230402122252.png";
//                     }

//                     if(oldSrc.includes("chara3.png") || oldSrc.includes("Untitled34_20230402123124.png") || oldSrc.includes("Untitled34_20230402123255.png"))
//                     {
//                         img.src = "Asset untuk html/Evolusi chara/Untitled34_20230402123255.png";
//                     }
//                 }
//             } else 
//             {
//                 // Jika belum, tingkatkan exp
//                 expMeter.value = newExp;
//             }
//         }
// // Panggil fungsi increaseExp setiap 20 detik
//         setInterval(increaseExp, 100);

        var health = localStorage.getItem("health");
        document.getElementById("health").value = health;
        var food = localStorage.getItem("food");
        document.getElementById("food").value = food;
        var sleep = localStorage.getItem("sleep");
        document.getElementById("sleep").value = sleep;
    </script>
</body>
</html>
